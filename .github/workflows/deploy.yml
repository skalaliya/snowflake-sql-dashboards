name: Deploy to Snowflake

on:
  push:
    branches: [ main ]
  workflow_dispatch:

concurrency:
  group: snowflake-deploy
  cancel-in-progress: true

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy to Snowflake
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: Deploy to Snowflake
        env:
          SNOW_ACCOUNT: ${{ secrets.SNOW_ACCOUNT }}
          SNOW_USER: ${{ secrets.SNOW_USER }}
          SNOW_PASSWORD: ${{ secrets.SNOW_PASSWORD }}
          SNOW_ROLE: ${{ secrets.SNOW_ROLE }}
          SNOW_WAREHOUSE: ${{ secrets.SNOW_WAREHOUSE }}
          SNOW_DATABASE: ${{ secrets.SNOW_DATABASE }}
          SNOW_SCHEMA: ${{ secrets.SNOW_SCHEMA }}
          STOP_ON_ERROR: 1
        run: |
          echo "ðŸš€ Starting Snowflake deployment..."
          python scripts/deploy.py
          echo "âœ… Deployment completed successfully!"

